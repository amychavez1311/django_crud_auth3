{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="cv-layout">
  <div class="cv-container">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="photo-section">
        <div class="photo-frame">
          {% if datos.fotoperfil %}
            <img src="{{ datos.fotoperfil.url }}" alt="Foto" class="profile-photo">
          {% else %}
            <div class="profile-photo" style="background: linear-gradient(135deg,#ffeaf2,#fff0f6); display:flex; align-items:center; justify-content:center;">
              <i class="bi bi-person-fill" style="font-size:2.6rem; color:#c76f8a"></i>
            </div>
          {% endif %}
        </div>
        <div class="name-title mt-3">
          <h1>{{ datos.nombres }} {{ datos.apellidos }}</h1>
          {% if datos.descripcionperfil %}<p>{{ datos.descripcionperfil }}</p>{% endif %}
        </div>
      </div>

      <div class="sidebar-section">
        <h3>Contacto</h3>
        <div class="contact-item">
          <i class="bi bi-envelope-fill"></i>
          <div>
            {% if user.email %}<div>{{ user.email }}</div>{% endif %}
            {% if datos.sitioweb %}<a href="{{ datos.sitioweb }}" target="_blank">{{ datos.sitioweb }}</a>{% endif %}
          </div>
        </div>
        {% if datos.telefonoconvencional %}
        <div class="contact-item"><i class="bi bi-telephone-fill"></i><div>{{ datos.telefonoconvencional }}</div></div>
        {% endif %}
        {% if datos.telefonofijo %}
        <div class="contact-item"><i class="bi bi-telephone"></i><div>{{ datos.telefonofijo }}</div></div>
        {% endif %}
      </div>

      <div class="sidebar-section">
        <h3>Datos</h3>
        {% if datos.numerocedula %}<div><strong>Cédula:</strong> {{ datos.numerocedula }}</div>{% endif %}
        {% if datos.nacionalidad %}<div><strong>Nacionalidad:</strong> {{ datos.nacionalidad }}</div>{% endif %}
        {% if datos.fechanacimiento %}<div><strong>Nacimiento:</strong> {{ datos.fechanacimiento|date:"d/m/Y" }}</div>{% endif %}
        {% if datos.estadocivil %}<div><strong>Estado Civil:</strong> {{ datos.estadocivil }}</div>{% endif %}
      </div>

      <div class="sidebar-section" style="margin-top:auto;">
        <a href="{% url 'crear_datos_personales' %}" class="btn add-btn w-100">Editar Datos</a>
      </div>
    </aside>

    <!-- Main content -->
    <main class="main-content">
      <div class="d-flex justify-content-end mb-3">
        <a href="{% url 'visualizar_cv_pdf' %}" target="_blank" class="btn btn-primary me-2">Ver PDF</a>
        <a href="{% url 'descargar_cv_pdf' %}" class="btn btn-outline-soft">Descargar</a>
      </div>

      <div class="content-grid">
        <!-- Experiencia -->
        <section class="section card">
          <div class="section-header">
            <h2 class="section-title">Experiencia Profesional</h2>
            <a href="{% url 'crear_experiencia_laboral' %}" class="add-btn">Agregar</a>
          </div>
          {% if experiencias %}
            {% for exp in experiencias %}
              <div class="mb-3">
                <h5 class="mb-0">{{ exp.cargodesempenado }}</h5>
                <small class="text-muted">{{ exp.nombreempresa }} • {{ exp.fechainiciogestion|date:"M Y" }}{% if exp.fechafingestion %} - {{ exp.fechafingestion|date:"M Y" }}{% else %} - Presente{% endif %}</small>
                {% if exp.descripcionfunciones %}<p class="mt-2 small">{{ exp.descripcionfunciones }}</p>{% endif %}
                <div class="d-flex gap-2">
                  <a href="{% url 'editar_experiencia_laboral' exp.id %}" class="btn btn-outline-soft">Editar</a>
                  <form method="POST" action="{% url 'eliminar_experiencia_laboral' exp.id %}">{% csrf_token %}<button class="btn btn-outline-soft">Eliminar</button></form>
                </div>
              </div>
            {% endfor %}
          {% else %}
            <div class="empty-state">Sin experiencias registradas. <a href="{% url 'crear_experiencia_laboral' %}">Agregar</a></div>
          {% endif %}
        </section>

        <!-- Cursos -->
        <section class="section card">
          <div class="section-header">
            <h2 class="section-title">Formación y Cursos</h2>
            <a href="{% url 'crear_curso' %}" class="add-btn">Agregar</a>
          </div>
          {% if cursos %}
            {% for curso in cursos %}
              <div class="mb-3">
                <h5 class="mb-0">{{ curso.nombrecurso }}</h5>
                <small class="text-muted">{{ curso.entidadpatrocinadora }} • {{ curso.fechainicio|date:"M Y" }}{% if curso.fechafin %} - {{ curso.fechafin|date:"M Y" }}{% endif %}{% if curso.totalhoras %} • {{ curso.totalhoras }} hrs{% endif %}</small>
                {% if curso.descripcioncurso %}<p class="mt-2 small">{{ curso.descripcioncurso }}</p>{% endif %}
                <div class="d-flex gap-2">
                  <a href="{% url 'editar_curso' curso.id %}" class="btn btn-outline-soft">Editar</a>
                  <form method="POST" action="{% url 'eliminar_curso' curso.id %}">{% csrf_token %}<button class="btn btn-outline-soft">Eliminar</button></form>
                </div>
              </div>
            {% endfor %}
          {% else %}
            <div class="empty-state">Sin cursos registrados. <a href="{% url 'crear_curso' %}">Agregar</a></div>
          {% endif %}
        </section>

        <!-- Reconocimientos -->
        <section class="section card">
          <div class="section-header">
            <h2 class="section-title">Reconocimientos</h2>
            <a href="{% url 'crear_reconocimiento' %}" class="add-btn">Agregar</a>
          </div>
          {% if reconocimientos %}
            {% for reco in reconocimientos %}
              <div class="mb-3">
                <h5 class="mb-0">{{ reco.get_tiporeconocimiento_display }}</h5>
                <small class="text-muted">{{ reco.entidadpatrocinadora }} • {{ reco.fechareconocimiento|date:"d M Y" }}</small>
                {% if reco.descripcionreconocimiento %}<p class="mt-2 small">{{ reco.descripcionreconocimiento }}</p>{% endif %}
                <div class="d-flex gap-2">
                  <a href="{% url 'editar_reconocimiento' reco.id %}" class="btn btn-outline-soft">Editar</a>
                  <form method="POST" action="{% url 'eliminar_reconocimiento' reco.id %}">{% csrf_token %}<button class="btn btn-outline-soft">Eliminar</button></form>
                </div>
              </div>
            {% endfor %}
          {% else %}
            <div class="empty-state">Sin reconocimientos. <a href="{% url 'crear_reconocimiento' %}">Agregar</a></div>
          {% endif %}
        </section>

        <!-- Productos (combinado) -->
        <section class="section card">
          <div class="section-header">
            <h2 class="section-title">Productos y Ventas</h2>
            <div></div>
          </div>
          {% if productos_academicos %}
            <h6>Académicos</h6>
            <div class="row">
              {% for prod in productos_academicos %}
                <div class="col-md-6 mb-2">
                  <div class="card p-2">
                    <strong>{{ prod.nombrerecurso }}</strong>
                    <div class="small text-muted">{{ prod.clasificador }}</div>
                  </div>
                </div>
              {% endfor %}
            </div>
          {% endif %}

          {% if productos_laborales %}
            <h6 class="mt-3">Laborales</h6>
            <div class="row">
              {% for prod in productos_laborales %}
                <div class="col-md-6 mb-2">
                  <div class="card p-2">
                    <strong>{{ prod.nombreproducto }}</strong>
                    <div class="small text-muted">{{ prod.fechaproducto|date:"d M Y" }}</div>
                  </div>
                </div>
              {% endfor %}
            </div>
          {% endif %}

          {% if ventas %}
            <h6 class="mt-3">En Venta</h6>
            <div class="row">
              {% for venta in ventas %}
                <div class="col-md-6 mb-2">
                  <div class="card p-2">
                    <strong>{{ venta.nombreproducto }}</strong>
                    <div class="small text-muted">{{ venta.estadoproducto }} • ${{ venta.valordelbien }}</div>
                  </div>
                </div>
              {% endfor %}
            </div>
          {% endif %}
        </section>
      </div>
    </main>
  </div>
  </div>

  <style>
    /* Small adjustments that complement tasks/static/tasks/css/style.css */
    .cv-layout{ padding:2.2rem; background: linear-gradient(135deg,#fffafc 0%, #fff7fb 100%);} 
    .cv-container{ max-width:1180px; margin:0 auto; display:flex; gap:1.6rem; }
    .sidebar{ flex:0 0 320px; display:flex; flex-direction:column; background:linear-gradient(180deg,#ffdede 0%, #ffc4d0 60%, #ff9bb3 100%); color:#4a2330; border-radius:16px; padding:1rem; }
    .main-content{ flex:1; }
    .photo-frame{ width:120px; height:120px; margin:0 auto; border-radius:50%; overflow:hidden; border:6px solid rgba(255,255,255,0.6); }
    .profile-photo{ width:100%; height:100%; object-fit:cover; display:block; }
    .name-title h1{ margin:0; font-size:1.25rem; color:#5a2b3a; }
    .name-title p{ margin:0.3rem 0 0; color:#5a2b3a; }
    .section-title{ font-weight:800; color:#5a2b3a; }
    .add-btn{ background:transparent; border:2px solid rgba(255,120,150,0.12); color:#ff6f98; padding:0.35rem 0.9rem; border-radius:999px; font-weight:700; }
    .card{ border-radius:12px; box-shadow:0 8px 22px rgba(120,90,110,0.04); padding:1rem; }
    .empty-state{ padding:1rem; border-radius:10px; background:linear-gradient(180deg,#fff6fb,#fff0f5); text-align:center; color:#8a6b76; }
    .btn-primary{ background: linear-gradient(90deg,#ff9bb3,#ffb3c7); border:none; color:#fff; }
    .btn-outline-soft{ background:transparent; border:2px solid rgba(100,80,90,0.06); padding:0.35rem 0.6rem; border-radius:8px; }
    @media (max-width:1024px){ .cv-container{ flex-direction:column; } .sidebar{ width:100%; flex:0 0 auto; } }
  </style>

{% endblock %}